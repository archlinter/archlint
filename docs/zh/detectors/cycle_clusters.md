# 循环依赖集群

**ID:** `cycle_clusters` | **Severity:** Critical (default)

循环依赖集群是当循环依赖开始繁殖时发生的情况。这不只是一个简单的"A依赖B，B依赖A"的循环——而是一个复杂的网络，十几个模块全部纠缠在一起。

## 为什么这是一个坏味道

- **架构腐化**: 这是你的模块边界已经完全崩溃的信号。
- **"单体"效应**: 你不能只从集群中借一个模块；你必须把整个纠缠的混乱都拉进来。这是一个你没要求的打包交易。
- **无法隔离**: 想测试单个函数？太糟糕了，你现在正在 mock 一半的代码库，因为一切都是互相关联的。
- **维护噩梦**: 在集群中更改一个模块可能会触发不可预测的蝴蝶效应，在网络的另一端破坏某些东西。

## 示例

### 坏的

"core" 目录中的一组模块，几乎每个模块都从同一目录导入其他几个模块，创建了多个重叠的循环。

### 好的

模块应该按层次结构组织，或者具有清晰的基于接口的解耦，以确保循环不会形成集群。

## 配置

```yaml
rules:
  cycle_clusters:
    severity: high
    max_cluster_size: 5
```

## 如何修复

1. **打破核心**：识别参与多个循环的 "核心" 模块，并首先对其进行解耦。
2. **分层**：强制执行严格的分层规则，以防止水平或向上的依赖。
3. **重构单体**：集群通常表明单个大模块的拆分方式不正确。考虑合并或沿不同边界重新拆分。
