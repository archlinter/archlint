# 循環依存クラスター

**ID:** `cycle_clusters` | **Severity:** Critical (default)

循環依存クラスターは、循環依存が繁殖し始めたときに起こる現象です。単純な「AがBに依存、BがAに依存」というループではなく、10個以上のモジュールがすべて絡み合った複雑な網です。

## なぜこれが「不吉な臭い」なのか

- **アーキテクチャの腐敗**: モジュールの境界が完全に崩壊していることのサインです。
- **「モノリス」効果**: クラスターから1つのモジュールだけを借りることはできません。絡み合った全体を引っ張ってこなければなりません。頼んでもいないパッケージ取引です。
- **隔離の不可能**: 1つの関数をテストしたいだけなのに、残念ながら、すべてが相互接続されているため、コードベースの半分をモック化することになります。
- **メンテナンスの悪夢**: クラスター内の1つのモジュールを変更すると、予測できない波及効果が発生し、網の反対側で何かが壊れる可能性があります。

## 例

### 悪い例

"core" ディレクトリ内のモジュール群で、ほぼすべてのモジュールが同じディレクトリから他の複数のモジュールをインポートし、複数の重複する循環を作成している。

### 良い例

モジュールは階層構造で、または明確なインターフェースベースのデカップリングを使用して編成され、循環がクラスターを形成しないようにする必要があります。

## 設定

```yaml
rules:
  cycle_clusters:
    severity: high
    max_cluster_size: 5
```

## 修正方法

1. **ハブを壊す**: 複数の循環に関与する「ハブ」モジュールを特定し、最初にそれらをデカップリングします。
2. **レイヤリング**: 水平方向または上方向の依存関係を防ぐために、厳格なレイヤリングルールを強制します。
3. **モノリスの再構築**: クラスターは、単一の大きなモジュールが正しく分割されなかったことを示していることがよくあります。マージするか、別の境界に沿って再分割することを検討してください。
