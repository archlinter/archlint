# Циклические зависимости

**ID:** `cycles` | **Степень критичности:** Критическая (по умолчанию)

Циклические зависимости возникают, когда два или более модулей зависят друг от друга напрямую или косвенно. Это классическая проблема «курицы и яйца» в разработке ПО.

## Почему это «запах»

- **Неразрывная связь**: Вы не можете просто взять один модуль и использовать его в другом месте — он потянет за собой целый «хвост» зависимостей.
- **Ловушки инициализации**: В зависимости от вашего сборщика, вы можете поймать `undefined` в импортах прямо во время работы приложения, потому что цикл не смог вовремя разрешиться.
- **Ад для тестов**: Попробуйте замокать одну часть цикла, чтобы вся конструкция не сложилась как карточный домик.
- **Когнитивный перегруз**: Пытаться проследить поток данных в цикле — это как читать книгу «выбери свое приключение», где каждая страница ведет обратно на первую.

## Примеры

### Плохо

```typescript
// orders.ts
import { processPayment } from './payments';
export const createOrder = () => {
  /* ... */
};

// payments.ts
import { createOrder } from './orders';
export const processPayment = () => {
  /* ... */
};
```

### Хорошо

Вынесите общую логику в третий модуль.

```typescript
// types.ts
export interface Order {
  /* ... */
}

// orders.ts
import { Order } from './types';
export const createOrder = () => {
  /* ... */
};

// payments.ts
import { Order } from './types';
export const processPayment = (order: Order) => {
  /* ... */
};
```

## Конфигурация

```yaml
rules:
  cycles:
    severity: critical
    exclude: ['**/*.entity.ts']
```

### Параметры по умолчанию

- `exclude`: `['**/*.entity.ts']` - паттерны файлов, которые исключаются из проверки на циклы

## Как исправить

1. **Вынесите общую логику**: Перенесите общие части в новый модуль, от которого будут зависеть оба исходных модуля.
2. **Внедрение зависимостей**: Передавайте зависимости в качестве аргументов вместо их импорта.
3. **Используйте события**: Используйте шину событий или обратные вызовы для развязки модулей.

## ESLint правило

Этот детектор доступен как правило ESLint для получения обратной связи в реальном времени.

```javascript
// eslint.config.js
export default [
  {
    rules: {
      '@archlinter/no-cycles': 'error',
    },
  },
];
```

Смотрите [Интеграция с ESLint](/ru/integrations/eslint) для инструкций по настройке.
